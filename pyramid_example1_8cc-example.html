<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Horny Toad Utility Functions: pyramid_example1.cc</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Horny Toad Utility Functions
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">pyramid_example1.cc</div>  </div>
</div><!--header-->
<div class="contents">
<p>This example generates multiresolution noise. </p>
<div class="image">
<img src="pyramid_example1_color.png" alt="pyramid_example1_color.png"/>
<div class="caption">
pyramid example1 color output</div></div>
 <div class="image">
<img src="pyramid_example1_grayscale.png" alt="pyramid_example1_grayscale.png"/>
<div class="caption">
pyramid example1 grayscale output</div></div>
<div class="fragment"><pre class="fragment"><span class="comment">// Pyramid Example</span>
<span class="comment">//</span>
<span class="comment">// Copyright (C) 2007 Jeffrey S. Perry</span>
<span class="comment">//</span>
<span class="comment">// This program is free software: you can redistribute it</span>
<span class="comment">// and/or modify it under the terms of the GNU General</span>
<span class="comment">// Public License as published by the Free Software</span>
<span class="comment">// Foundation, either version 3 of the License, or (at your</span>
<span class="comment">// option) any later version.</span>
<span class="comment">//</span>
<span class="comment">// This program is distributed in the hope that it will be</span>
<span class="comment">// useful, but WITHOUT ANY WARRANTY; without even the</span>
<span class="comment">// implied warranty of MERCHANTABILITY or FITNESS FOR A</span>
<span class="comment">// PARTICULAR PURPOSE.  See the GNU General Public License</span>
<span class="comment">// for more details.</span>
<span class="comment">//</span>
<span class="comment">// You should have received a copy of the GNU General Public</span>
<span class="comment">// License along with this program.  If not, see</span>
<span class="comment">// &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment">//</span>
<span class="comment">// contact: jeffsp@gmail.com</span>

<span class="preprocessor">#include &quot;<a class="code" href="pyramid_8h.html" title="pyramid container">horny_toad/pyramid.h</a>&quot;</span>
<span class="preprocessor">#include &lt;cstdlib&gt;</span>
<span class="preprocessor">#include &lt;fstream&gt;</span>
<span class="preprocessor">#include &lt;iostream&gt;</span>

<span class="keyword">using namespace </span>horny_toad;
<span class="keyword">using namespace </span>std;

<span class="comment">// PNM file writer helper</span>
<span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<span class="keywordtype">void</span> WritePNM (<span class="keyword">const</span> T &amp;m, ofstream &amp;ofs, <span class="keywordtype">bool</span> rgb = <span class="keyword">false</span>)
{
    <span class="comment">// Write a pnm header</span>
    ofs &lt;&lt; (rgb ? <span class="stringliteral">&quot;P6&quot;</span> : <span class="stringliteral">&quot;P5&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    ofs &lt;&lt; <span class="stringliteral">&quot;# Pyramid Example\n&quot;</span>;
    ofs &lt;&lt; (rgb ? m.cols () / 3 : m.cols ()) &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; m.rows () &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
    ofs &lt;&lt; <span class="stringliteral">&quot;255\n&quot;</span>;

    <span class="comment">// Transform to a vector of chars</span>
    vector&lt;char&gt; mm (m.begin (), m.end ());

    <span class="comment">// Write the pnm pixels</span>
    <span class="keyword">const</span> std::streamsize sz =
        <span class="keyword">static_cast&lt;</span>std::streamsize<span class="keyword">&gt;</span> (mm.size ());
    ofs.write (&amp;mm[0], sz);
}

<span class="comment">// Convert from YUV colorspace to RGB colorspace</span>
<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Ty&gt;
<span class="keyword">inline</span> <span class="keywordtype">float</span> YUVR (Ty y, Ty , Ty v)
{ <span class="keywordflow">return</span>  y + 1.14 * (v - 127.5); }
<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Ty&gt;
<span class="keyword">inline</span> <span class="keywordtype">float</span> YUVG (Ty y, Ty u, Ty v)
{ <span class="keywordflow">return</span>  y - 0.39 * (u - 127.5) - 0.58 * (v - 127.5); }
<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Ty&gt;
<span class="keyword">inline</span> <span class="keywordtype">float</span> YUVB (Ty y, Ty u, Ty )
{ <span class="keywordflow">return</span>  y + 2.03 * (u - 127.5); }
<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Ty&gt;
<span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> CLIP (Ty x)
{ <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span><span class="keyword">&gt;</span> (x &gt; 255 ? 255 : (x &lt; 0 ? 0 : x)); }

<span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
T yuv2rgb (<span class="keyword">const</span> T &amp;y, <span class="keyword">const</span> T &amp;u, <span class="keyword">const</span> T &amp;v)
{
    T rgb (y.rows (), y.cols () * 3);
    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; y.rows (); ++i) {
        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; y.cols (); ++j) {
            rgb (i, j * 3 + 0) = CLIP (YUVR (y (i, j), u (i, j), v (i, j)));
            rgb (i, j * 3 + 1) = CLIP (YUVG (y (i, j), u (i, j), v (i, j)));
            rgb (i, j * 3 + 2) = CLIP (YUVB (y (i, j), u (i, j), v (i, j)));
        }
    }
    <span class="keywordflow">return</span> rgb;
}

<span class="keywordtype">int</span> main ()
{
    <span class="keywordflow">try</span>
    {
        <span class="keyword">const</span> <span class="keywordtype">size_t</span> M = 240;
        <span class="keyword">const</span> <span class="keywordtype">size_t</span> N = 320;

        clog &lt;&lt; <span class="stringliteral">&quot;Generating a &quot;</span> &lt;&lt; M &lt;&lt; <span class="stringliteral">&quot;X&quot;</span> &lt;&lt; N
            &lt;&lt; <span class="stringliteral">&quot; image...&quot;</span> &lt;&lt; endl;

        <a name="_a0"></a><a class="code" href="classhorny__toad_1_1pyramid.html" title="pyramid container adapter">pyramid&lt;unsigned char&gt;</a> py (M, N);
        <a class="code" href="classhorny__toad_1_1pyramid.html" title="pyramid container adapter">pyramid&lt;unsigned char&gt;</a> pu (M, N);
        <a class="code" href="classhorny__toad_1_1pyramid.html" title="pyramid container adapter">pyramid&lt;unsigned char&gt;</a> pv (M, N);

        <span class="comment">// Generate some 1/f-like noise...</span>
        <span class="comment">//</span>
        <span class="comment">// Starting at the top of the pyramid...</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> l = py.levels () - 1; l &gt; 0; --l) {
            <span class="comment">// Randomize some pixels in this level</span>
            <span class="keyword">const</span> <span class="keywordtype">int</span> N = py[l].cols () / 8 + 1;
            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; py[l].rows (); ++i) {
                <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; py[l].cols (); ++j) {
                    <span class="keywordflow">if</span> (!(rand () % N)) {
                        py[l](i, j) = rand ();
                        pu[l](i, j) = rand ();
                        pv[l](i, j) = rand ();
                    }
                }
            }
            <span class="comment">// Expand to the next level</span>
            py.expand3x3 (l);
            pu.expand3x3 (l);
            pv.expand3x3 (l);
        }

        <span class="comment">// Save the image to a file</span>
        <span class="keyword">const</span> <span class="keywordtype">string</span> fn(<span class="stringliteral">&quot;pyramid_example1_grayscale.pgm&quot;</span>);
        clog &lt;&lt; <span class="stringliteral">&quot;Writing image to &quot;</span> &lt;&lt; fn &lt;&lt; <span class="stringliteral">&quot;...&quot;</span> &lt;&lt; endl;

        ofstream ofs (fn.c_str ());
        <span class="keywordflow">if</span> (!ofs)
            <span class="keywordflow">throw</span> std::runtime_error (<span class="stringliteral">&quot;Could not open file for writing&quot;</span>);

        WritePNM (py[0], ofs);

        <span class="comment">// Save the image to another file</span>
        <span class="keyword">const</span> <span class="keywordtype">string</span> fn_color(<span class="stringliteral">&quot;pyramid_example1_color.ppm&quot;</span>);
        clog &lt;&lt; <span class="stringliteral">&quot;Writing image to &quot;</span> &lt;&lt; fn_color &lt;&lt; <span class="stringliteral">&quot;...&quot;</span> &lt;&lt; endl;

        ofstream ofs_color (fn_color.c_str ());
        <span class="keywordflow">if</span> (!ofs_color)
            <span class="keywordflow">throw</span> std::runtime_error (<span class="stringliteral">&quot;Could not open file for writing&quot;</span>);

        WritePNM (yuv2rgb (py[0], pu[0], pv[0]), ofs_color, <span class="keyword">true</span>);

        <span class="keywordflow">return</span> 0;
    }
    <span class="keywordflow">catch</span> (<span class="keyword">const</span> exception &amp;e)
    {
        cerr &lt;&lt; e.what () &lt;&lt; endl;
        <span class="keywordflow">return</span> -1;
    }
}
</pre></div> </div><!-- contents -->
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Fri May 23 2014 12:48:31 for Horny Toad Utility Functions by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
